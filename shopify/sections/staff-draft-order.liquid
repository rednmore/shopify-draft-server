{%- comment -%}
<locksmith>
{% endcomment -%}

{{ 'tom-select.css'             | asset_url | stylesheet_tag }}
{{ 'tom-select.complete.min.js' | asset_url | script_tag }}
{{ 'staff-draft-order.css'      | asset_url | stylesheet_tag }}
{{ 'staff-draft-order.js'       | asset_url | script_tag }}

<div class="staff-draft-order-section"
     data-section-id="{{ section.id }}"
     data-placeholder="{{ section.settings.placeholder_text }}"
     data-please-select-customer-text="{{ section.settings.please_select_customer_text }}"
     data-creating-text="{{ section.settings.creating_text }}"
     data-order-created-text="{{ section.settings.order_created_text }}"
     data-post-order-link-text="{{ section.settings.post_order_link_text }}"
     data-validate-send-text="{{ section.settings.validate_send_text }}"
     data-sending-text="{{ section.settings.sending_text }}"
     data-send-error-text="{{ section.settings.send_error_text }}"
     data-sent-text="{{ section.settings.sent_text }}">
  <div class="staff-draft-order-container">
    <div class="staff-draft-order-wrapper">

      <!-- TITRE -->
      <h2 class="h2">{{ section.settings.page_title }}</h2>

      <!-- TEXTE D’AIDE -->
      {% if section.settings.show_help_text %}
        <div class="rte">
          {{ section.settings.help_text }}
        </div>
      {% endif %}

      <!-- SÉLECTEUR -->
      <div class="client-combobox" style="margin-bottom: 20px;">
        <label class="field__label">{{ section.settings.select_label }}</label>
        <select class="client-selector" style="width: 100%;">
            <!-- Option vide nécessaire pour que TomSelect initialise bien son combobox -->
            <option value=""></option>
        </select>
      </div>

      <!-- CSS VAR STYLES -->
      <style>
        :root {
          --button-bg: {{ section.settings.button_bg }};
          --button-text: {{ section.settings.button_text }};
          --button-border: {{ section.settings.button_border }};
        }
      </style>

<!-- CRÉER UN CLIENT (STAFF) -->
<div class="staff-create-customer" style="margin: 24px 0;">
  <details>
    <summary class="h4" style="cursor:pointer;">Créer un nouveau client</summary>
    <form class="staff-create-customer-form" novalidate>
      <div class="grid" style="gap:12px;margin-top:12px;">
        <div>
          <label>Email *</label>
          <input type="email" name="email" required>
        </div>
        <div>
          <label>Prénom *</label>
          <input type="text" name="first_name" required>
        </div>
        <div>
          <label>Nom *</label>
          <input type="text" name="last_name" required>
        </div>
        <div>
          <label>Entreprise (company) *</label>
          <input type="text" name="company" required>
        </div>
        <div>
          <label>Téléphone</label>
          <input type="tel" name="phone">
        </div>

        <!-- Adresse par défaut -->
        <div>
          <label>Adresse 1 *</label>
          <input type="text" name="address1" required>
        </div>
        <div>
          <label>Adresse 2</label>
          <input type="text" name="address2">
        </div>
        <div>
          <label>Code postal *</label>
          <input type="text" name="zip" required>
        </div>
        <div>
          <label>Ville *</label>
          <input type="text" name="city" required>
        </div>
        <div>
          <label>Pays (code ISO2, ex: CH) *</label>
          <input type="text" name="country_code" maxlength="2" required>
        </div>

        <!-- Optionnel: TVA / Note / Tags -->
        <div>
          <label>TVA (optionnel)</label>
          <input type="text" name="vat_number">
        </div>
        <div>
          <label>Note (optionnel)</label>
          <input type="text" name="note">
        </div>
        <div>
          <label>Tags (séparés par des virgules)</label>
          <input type="text" name="tags" placeholder="STAFF, B2B">
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
        <button type="submit" class="button" style="min-width:220px;">Créer le client</button>
        <span class="create-feedback body" aria-live="polite"></span>
      </div>
    </form>
  </details>
</div>


      <!-- BOUTON -->
      <div>
        <button class="button staff-order-button"
                style="
                  width: {{ section.settings.button_width }};
                  height: {{ section.settings.button_height }};
                  border-radius: {{ section.settings.button_radius }}px;
                  padding: {{ section.settings.button_padding }};
                  font-size: {{ section.settings.button_font_size }}px;
                  font-weight: {{ section.settings.button_font_weight }};
                ">
          {{ section.settings.button_label }}
        </button>
      </div>

      <!-- MESSAGES -->
      <div class="feedback body" aria-live="polite"></div>
      <div class="selected-info body"></div>

    </div>
  </div>
</div>

{% schema %}
{
  "name": "Staff Order",
  "tag": "section",
  "settings": [
    { "type": "text",    "id": "page_title",                  "label": "Page title",                             "default": "Create an order for a specific customer" },
    { "type": "text",    "id": "select_label",                "label": "Client selector label",                  "default": "Select a client:" },
    { "type": "color",   "id": "feedback_color",              "label": "Feedback message color",                 "default": "#000000" },
    { "type": "checkbox","id": "show_help_text",              "label": "Show help text",                         "default": true },
    { "type": "richtext","id": "help_text",                   "label": "Help text",                              "default": "<p>Use this interface to create an order for an existing customer.</p>" },
    { "type": "text",    "id": "button_label",                "label": "Button text",                            "default": "Create order" },
    { "type": "color",   "id": "button_bg",                   "label": "Button background color",                "default": "#e6e6e6" },
    { "type": "color",   "id": "button_text",                 "label": "Button text color",                      "default": "#000000" },
    { "type": "color",   "id": "button_border",               "label": "Button border color",                    "default": "#000000" },
    { "type": "range",   "id": "button_radius",               "label": "Button border radius (px)",              "min": 0, "max": 20, "step": 1, "default": 6 },
    { "type": "text",    "id": "button_padding",              "label": "Button padding",                         "default": "10px 20px" },
    { "type": "range",   "id": "button_font_size",            "label": "Font size (px)",                         "min": 12, "max": 30, "step": 1, "default": 16 },
    { "type": "text",    "id": "placeholder_text",            "label": "Placeholder text",                       "default": "Search for opticians…" },
    { "type": "text",    "id": "order_created_text",          "label": "Order created text",                     "default": "Order created" },
    { "type": "text",    "id": "post_order_link_text",        "label": "Post-order link text",                   "default": "Send order to optician" },
    { "type": "text",    "id": "please_select_customer_text", "label": "Error text: please select customer",      "default": "Please select a customer" },
    {
      "type": "select",
      "id":   "button_font_weight",
      "label":"Font weight",
      "options": [
        { "value": "normal",  "label": "Normal" },
        { "value": "bold",    "label": "Bold" },
        { "value": "lighter", "label": "Light" }
      ],
      "default": "normal"
    },
    { "type": "text",    "id": "button_width",                "label": "Button width",                          "default": "100%" },
    { "type": "text",    "id": "button_height",               "label": "Button height",                         "default": "44px" }
  ],
  "presets": [
    { "name": "Staff order", "category": "Custom" }
  ]
}
{% endschema %}
